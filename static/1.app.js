(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(i(12)),n=s(i(3));function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}i(32),i(35),i(40),a.default.defaults.headers.post["X-CSRF-Token"]=document.querySelector('meta[name="csrf-token"]').getAttribute("content");var r=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui={editor:t.querySelector("[data-editor-edit]"),form:t.querySelector("[data-editor-form]"),loader:t.querySelector("[data-editor-loader]"),message:t.querySelector("[data-editor-message]"),preview:t.querySelector("[data-editor-preview]"),togglePreview:t.querySelector("[data-editor-toggle-preview]"),self:t},this.isDirty=!1,this.isUpdating=!1,this.lastContent="",this.cm=new n.default.fromTextArea(this.ui.editor,{autofocus:!0,lineNumbers:!0,lineWrapping:!0,mode:"gfm",theme:"monokai"}),this.cm.on("changes",function(){i.isDirty=!0}),this.ui.form.addEventListener("submit",this.onSubmit.bind(this)),this.ui.togglePreview.addEventListener("click",this.onTogglePreview.bind(this)),window.addEventListener("beforeunload",this.onUnload.bind(this)),setInterval(this.onUpdatePreview.bind(this),1e3),this.onUpdatePreview()}return function(e,t,i){t&&o(e.prototype,t),i&&o(e,i)}(e,[{key:"onUnload",value:function(e){if(this.isDirty){e.preventDefault();var t="Leave page and destroy changes?";return event.returnValue=t,t}}},{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.isLoading=!0,a.default.post(this.ui.form.target,{data:this.cm.getValue(),message:this.ui.message.value}).then(function(e){t.isDirty=!1,window.location=t.ui.self.dataset.linkpath})}},{key:"onTogglePreview",value:function(e){e.preventDefault();this.ui.self.classList[this.ui.self.classList.contains("o-editor--show-preview")?"remove":"add"]("o-editor--show-preview")}},{key:"onUpdatePreview",value:function(){var e=this,t=this.cm.getValue();if(this.isUpdating||t===this.lastContent)this.isLoading=!1;else{this.isLoading=!0,this.isUpdating=!0,this.lastContent=t;a.default.post("/edit/_preview",{data:this.lastContent,filepath:this.ui.self.dataset.filepath}).then(function(t){e.isLoading=!1,e.isUpdating=!1,e.ui.preview.innerHTML=t.data})}}},{key:"isLoaderVisible",set:function(e){this.ui.loader.classList[e?"add":"remove"]("m-editor-header__loader--visible")}},{key:"isLoading",set:function(e){var t=this;clearTimeout(this.loaderTimeout),e?this.loaderTimeout=setTimeout(function(){return t.isLoaderVisible=!0},500):this.isLoaderVisible=!1}}]),e}();t.default=r}]]);